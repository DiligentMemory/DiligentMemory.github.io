<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL索引详解 | 程序咖啡屋</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <script>
        var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?5a16afb5272fc443793a34edbb191223";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
          })();</script>
    <meta name="description" content=" ">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.41e46469.css" as="style"><link rel="preload" href="/assets/js/app.b6f48787.js" as="script"><link rel="preload" href="/assets/js/7.ec9bc4d0.js" as="script"><link rel="preload" href="/assets/js/2.0c7886bd.js" as="script"><link rel="preload" href="/assets/js/1.8f3833ee.js" as="script"><link rel="preload" href="/assets/js/49.2076ec88.js" as="script"><link rel="prefetch" href="/assets/js/10.f07b9d93.js"><link rel="prefetch" href="/assets/js/11.aedf7da4.js"><link rel="prefetch" href="/assets/js/14.916cb05d.js"><link rel="prefetch" href="/assets/js/15.d2ca7161.js"><link rel="prefetch" href="/assets/js/16.1d522888.js"><link rel="prefetch" href="/assets/js/17.2e659a4d.js"><link rel="prefetch" href="/assets/js/18.34c83be0.js"><link rel="prefetch" href="/assets/js/19.c3b5106c.js"><link rel="prefetch" href="/assets/js/20.8c72a05c.js"><link rel="prefetch" href="/assets/js/21.988faded.js"><link rel="prefetch" href="/assets/js/22.ad121b6e.js"><link rel="prefetch" href="/assets/js/23.737b3f7d.js"><link rel="prefetch" href="/assets/js/24.1a965937.js"><link rel="prefetch" href="/assets/js/25.c6c69c96.js"><link rel="prefetch" href="/assets/js/26.41565a57.js"><link rel="prefetch" href="/assets/js/27.ce6a8795.js"><link rel="prefetch" href="/assets/js/28.929a98ba.js"><link rel="prefetch" href="/assets/js/29.85cdba7a.js"><link rel="prefetch" href="/assets/js/3.6ea7db73.js"><link rel="prefetch" href="/assets/js/30.c90c4bbc.js"><link rel="prefetch" href="/assets/js/31.aa085ec1.js"><link rel="prefetch" href="/assets/js/32.fa884116.js"><link rel="prefetch" href="/assets/js/33.8ba5d925.js"><link rel="prefetch" href="/assets/js/34.28bf7738.js"><link rel="prefetch" href="/assets/js/35.9a6f067b.js"><link rel="prefetch" href="/assets/js/36.ae5fa301.js"><link rel="prefetch" href="/assets/js/37.8bc0bf7a.js"><link rel="prefetch" href="/assets/js/38.efe0ec45.js"><link rel="prefetch" href="/assets/js/39.991d6637.js"><link rel="prefetch" href="/assets/js/4.89f90316.js"><link rel="prefetch" href="/assets/js/40.df4a9cc6.js"><link rel="prefetch" href="/assets/js/41.2123a88d.js"><link rel="prefetch" href="/assets/js/42.f784a0f3.js"><link rel="prefetch" href="/assets/js/43.7b51a092.js"><link rel="prefetch" href="/assets/js/44.74c7afa3.js"><link rel="prefetch" href="/assets/js/45.c70512b8.js"><link rel="prefetch" href="/assets/js/46.9c1223a5.js"><link rel="prefetch" href="/assets/js/47.2af81677.js"><link rel="prefetch" href="/assets/js/48.0618d55d.js"><link rel="prefetch" href="/assets/js/5.4683e3fa.js"><link rel="prefetch" href="/assets/js/6.f0e0fc80.js"><link rel="prefetch" href="/assets/js/8.77d757b7.js"><link rel="prefetch" href="/assets/js/9.81c499b5.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5164d387.js">
    <link rel="stylesheet" href="/assets/css/0.styles.41e46469.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>程序咖啡屋</h3> <p class="description" data-v-59e6cb88> </p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Luke</span>
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="程序咖啡屋" class="logo"> <span class="site-name">程序咖啡屋</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/后端开发/" class="nav-link"><i class="undefined"></i>
  后端开发
</a></li><li class="dropdown-item"><!----> <a href="/categories/MySQL/" class="nav-link"><i class="undefined"></i>
  MySQL
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    Luke
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>11</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>4</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/后端开发/" class="nav-link"><i class="undefined"></i>
  后端开发
</a></li><li class="dropdown-item"><!----> <a href="/categories/MySQL/" class="nav-link"><i class="undefined"></i>
  MySQL
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>MySQL索引详解</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Luke</span>
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">MySQL索引详解</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>Luke</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>11/12/2023</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>MySQL</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="索引介绍"><a href="#索引介绍" class="header-anchor">#</a> 索引介绍</h2> <p><strong>索引是一种用于快速查询和检索数据的数据结构，其本质可以看成是一种排序好的数据结构。</strong></p> <p>索引的作用就相当于书的目录。打个比方: 我们在查字典的时候，如果没有目录，那我们就只能一页一页的去找我们需要查的那个字，速度很慢。如果有目录了，我们只需要先去目录里查找字的位置，然后直接翻到那一页就行了。</p> <p>索引底层数据结构存在很多种类型，常见的索引结构有: <code>B 树</code>， <code>B+树</code> 和 <code>Hash</code>、<code>红黑树</code>。在 MySQL 中，无论是 Innodb 还是 MyIsam，都使用了 B+树作为索引结构。</p> <h2 id="索引的优缺点"><a href="#索引的优缺点" class="header-anchor">#</a> 索引的优缺点</h2> <p><strong>优点</strong>：</p> <ul><li>使用索引可以大大加快 数据的检索速度（大大减少检索的数据量）, 这也是创建索引的最主要的原因。</li> <li>通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。</li></ul> <p><strong>缺点</strong>：</p> <ul><li>创建索引和维护索引需要耗费许多时间。当对表中的数据进行增删改的时候，如果数据有索引，那么索引也需要动态的修改，会降低 SQL 执行效率。</li> <li>索引需要使用物理文件存储，也会耗费一定空间。</li></ul> <p>但是，<strong>使用索引一定能提高查询性能吗?</strong></p> <p>大多数情况下，索引查询都是比全表扫描要快的。但是如果数据库的数据量不大，那么使用索引也不一定能够带来很大提升。</p> <h2 id="索引底层数据结构选型"><a href="#索引底层数据结构选型" class="header-anchor">#</a> 索引底层数据结构选型</h2> <h3 id="hash表"><a href="#hash表" class="header-anchor">#</a> Hash表</h3> <p>哈希表是键值对的集合，通过键(key)即可快速取出对应的值(value)，因此哈希表可以快速检索数据（接近 O（1））。</p> <p><strong>为何能够通过 key 快速取出 value 呢？</strong> 原因在于 <strong>哈希算法</strong>（也叫散列算法）。通过哈希算法，我们可以快速找到 key 对应的 index，找到了 index 也就找到了对应的 value。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>hash <span class="token operator">=</span> <span class="token function">hashfunc</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
index <span class="token operator">=</span> hash <span class="token operator">%</span> array_size
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032115787.png" alt="img"></p> <p>但是！哈希算法有个 <strong>Hash 冲突</strong> 问题，也就是说多个不同的 key 最后得到的 index 相同。通常情况下，我们常用的解决办法是 <strong>链地址法</strong>。链地址法就是将哈希冲突数据存放在链表中。就比如 JDK1.8 之前 <code>HashMap</code> 就是通过链地址法来解决哈希冲突的。不过，JDK1.8 以后<code>HashMap</code>为了减少链表过长的时候搜索时间过长引入了红黑树。</p> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032115034.png" alt="img"></p> <p>为了减少 Hash 冲突的发生，一个好的哈希函数应该“均匀地”将数据分布在整个可能的哈希值集合中。</p> <p>MySQL 的 InnoDB 存储引擎不直接支持常规的哈希索引，但是，InnoDB 存储引擎中存在一种特殊的“自适应哈希索引”（Adaptive Hash Index），自适应哈希索引并不是传统意义上的纯哈希索引，而是结合了 B+Tree 和哈希索引的特点，以便更好地适应实际应用中的数据访问模式和性能需求。自适应哈希索引的每个哈希桶实际上是一个小型的 B+Tree 结构。这个 B+Tree 结构可以存储多个键值对，而不仅仅是一个键。这有助于减少哈希冲突链的长度，提高了索引的效率。</p> <p>既然哈希表这么快，<strong>为什么 MySQL 没有使用其作为索引的数据结构呢？</strong> 主要是因为 Hash 索引不支持顺序和范围查询。假如我们要对表中的数据进行排序或者进行范围查询，那 Hash 索引可就不行了。并且，每次 IO 只能取一个。</p> <p>试想一种情况:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tb1 <span class="token keyword">WHERE</span> id <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在这种范围查询中，优势非常大，直接遍历比 500 小的叶子节点就够了。而 Hash 索引是根据 hash 算法来定位的，难不成还要把 1 - 499 的数据，每个都进行一次 hash 计算来定位吗?这就是 Hash 最大的缺点了。</p> <h3 id="二叉查找树-bst"><a href="#二叉查找树-bst" class="header-anchor">#</a> 二叉查找树(BST)</h3> <p>二叉查找树（Binary Search Tree）是一种基于二叉树的数据结构，它具有以下特点：</p> <ol><li>左子树所有节点的值均小于根节点的值。</li> <li>右子树所有节点的值均大于根节点的值。</li> <li>左右子树也分别为二叉查找树。</li></ol> <p>当二叉查找树是平衡的时候，也就是树的每个节点的左右子树深度相差不超过 1 的时候，查询的时间复杂度为 O(log2(N))，具有比较高的效率。然而，当二叉查找树不平衡时，例如在最坏情况下（有序插入节点），树会退化成线性链表（也被称为斜树），导致查询效率急剧下降，时间复杂退化为 O（N）。</p> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032124017.png" alt="image-20231103212448985"></p> <p>也就是说，<strong>二叉查找树的性能非常依赖于它的平衡程度，这就导致其不适合作为 MySQL 底层索引的数据结构。</strong></p> <p>为了解决这个问题，并提高查询效率，人们发明了多种在二叉查找树基础上的改进型数据结构，如平衡二叉树、B-Tree、B+Tree 等。</p> <h3 id="avl-树"><a href="#avl-树" class="header-anchor">#</a> AVL 树</h3> <p>AVL 树是计算机科学中最早被发明的自平衡二叉查找树，它的名称来自于发明者 G.M. Adelson-Velsky 和 E.M. Landis 的名字缩写。AVL 树的特点是保证任何节点的左右子树高度之差不超过 1，因此也被称为高度平衡二叉树，它的查找、插入和删除在平均和最坏情况下的时间复杂度都是 O(logn)。</p> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032125339.png" alt="AVL 树"></p> <p>AVL 树采用了旋转操作来保持平衡。主要有四种旋转操作：LL 旋转、RR 旋转、LR 旋转和 RL 旋转。其中 LL 旋转和 RR 旋转分别用于处理左左和右右失衡，而 LR 旋转和 RL 旋转则用于处理左右和右左失衡。</p> <p>由于 AVL 树需要频繁地进行旋转操作来保持平衡，因此会有较大的计算开销进而降低了查询性能。并且， 在使用 AVL 树时，每个树节点仅存储一个数据，而每次进行磁盘 IO 时只能读取一个节点的数据，如果需要查询的数据分布在多个节点上，那么就需要进行多次磁盘 IO。 <strong>磁盘 IO 是一项耗时的操作，在设计数据库索引时，我们需要优先考虑如何最大限度地减少磁盘 IO 操作的次数。</strong></p> <p>实际应用中，AVL 树使用的并不多。</p> <h3 id="红黑树"><a href="#红黑树" class="header-anchor">#</a> 红黑树</h3> <p>红黑树是一种自平衡二叉查找树，通过在插入和删除节点时进行颜色变换和旋转操作，使得树始终保持平衡状态，它具有以下特点：</p> <ol><li>每个节点非红即黑；</li> <li>根节点总是黑色的；</li> <li>每个叶子节点都是黑色的空节点（NIL 节点）；</li> <li>如果节点是红色的，则它的子节点必须是黑色的（反之不一定）；</li> <li>从根节点到叶节点或空子节点的每条路径，必须包含相同数目的黑色节点（即相同的黑色高度）。</li></ol> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032126713.png" alt="红黑树"></p> <p>和 AVL 树不同的是，红黑树并不追求严格的平衡，而是大致的平衡。正因如此，红黑树的查询效率稍有下降，因为红黑树的平衡性相对较弱，可能会导致树的高度较高，这可能会导致一些数据需要进行多次磁盘 IO 操作才能查询到，这也是 MySQL 没有选择红黑树的主要原因。也正因如此，红黑树的插入和删除操作效率大大提高了，因为红黑树在插入和删除节点时只需进行 O(1) 次数的旋转和变色操作，即可保持基本平衡状态，而不需要像 AVL 树一样进行 O(logn) 次数的旋转操作。</p> <p><strong>红黑树的应用还是比较广泛的，TreeMap、TreeSet 以及 JDK1.8 的 HashMap 底层都用到了红黑树。对于数据在内存中的这种情况来说，红黑树的表现是非常优异的。</strong></p> <h3 id="b-树-b-树"><a href="#b-树-b-树" class="header-anchor">#</a> B 树&amp; B+树</h3> <p>B 树也称 B-树,全称为 <strong>多路平衡查找树</strong> ，俗称矮胖树，B+ 树是 B 树的一种变体。B 树和 B+树中的 B 是 <code>Balanced</code> （平衡）的意思。</p> <p>目前大部分数据库系统及文件系统都采用 B-Tree 或其变种 B+Tree 作为索引结构。</p> <p><strong>B 树&amp; B+树两者有何异同呢？</strong></p> <ul><li>B 树的所有节点既存放键(key) 也存放数据(data)，而 B+树只有叶子节点存放 key 和 data，其他内节点只存放 key。</li> <li>B 树的叶子节点都是独立的;B+树的叶子节点有一条引用链指向与它相邻的叶子节点。</li> <li>B 树的检索的过程相当于对范围内的每个节点的关键字做二分查找，可能还没有到达叶子节点，检索就结束了。而 B+树的检索效率就很稳定了，任何查找都是从根节点到叶子节点的过程，叶子节点的顺序检索很明显。</li> <li>在 B 树中进行范围查询时，首先找到要查找的下限，然后对 B 树进行中序遍历，直到找到查找的上限；而 B+树的范围查询，只需要对链表进行遍历即可。</li></ul> <p>综上，B+树与 B 树相比，具备更少的 IO 次数、更稳定的查询效率和更适于范围查询这些优势。</p> <h2 id="索引类型总结"><a href="#索引类型总结" class="header-anchor">#</a> 索引类型总结</h2> <p>按照数据结构维度划分：</p> <ul><li><p>BTree 索引：MySQL 里默认和最常用的索引类型。只有叶子节点存储 value，非叶子节点只有指针和 key。存储引擎 MyISAM 和 InnoDB 实现 BTree 索引都是使用 B+Tree，但二者实现方式不一样（前面已经介绍了）。</p></li> <li><p>哈希索引：类似键值对的形式，一次即可定位。</p></li> <li><p>RTree 索引：一般不会使用，仅支持 geometry 数据类型，优势在于范围查找，效率较低，通常使用搜索引擎如 ElasticSearch 代替。</p></li> <li><p>全文索引：对文本的内容进行分词，进行搜索。目前只有 <code>CHAR</code>、<code>VARCHAR</code> ，<code>TEXT</code> 列上可以创建全文索引。一般不会使用，效率较低，通常使用搜索引擎如 ElasticSearch 代替。</p></li></ul> <p>按照底层存储方式角度划分：</p> <ul><li><p>聚簇索引（聚集索引）：索引结构和数据一起存放的索引，InnoDB 中的主键索引就属于聚簇索引。</p></li> <li><p>非聚簇索引（非聚集索引）：索引结构和数据分开存放的索引，二级索引(辅助索引)就属于非聚簇索引。MySQL 的 MyISAM 引擎，不管主键还是非主键，使用的都是非聚簇索引。</p></li></ul> <p>按照应用维度划分：</p> <ul><li><p>主键索引：加速查询 + 列值唯一（不可以有 NULL）+ 表中只有一个。</p></li> <li><p>普通索引：仅加速查询。</p></li> <li><p>唯一索引：加速查询 + 列值唯一（可以有 NULL）。</p></li> <li><p>覆盖索引：一个索引包含（或者说覆盖）所有需要查询的字段的值。</p></li> <li><p>联合索引：多列值组成一个索引，专门用于组合搜索，其效率大于索引合并。</p></li> <li><p>全文索引：对文本的内容进行分词，进行搜索。目前只有 <code>CHAR</code>、<code>VARCHAR</code> ，<code>TEXT</code> 列上可以创建全文索引。一般不会使用，效率较低，通常使用搜索引擎如 ElasticSearch 代替。</p></li></ul> <p>MySQL 8.x 中实现的索引新特性：</p> <ul><li><p>隐藏索引：也称为不可见索引，不会被优化器使用，但是仍然需要维护，通常会软删除和灰度发布的场景中使用。主键不能设置为隐藏（包括显式设置或隐式设置）。</p></li> <li><p>降序索引：之前的版本就支持通过 desc 来指定索引为降序，但实际上创建的仍然是常规的升序索引。直到 MySQL 8.x 版本才开始真正支持降序索引。另外，在 MySQL 8.x 版本中，不再对 GROUP BY 语句进行隐式排序。</p></li> <li><p>函数索引：从 MySQL 8.0.13 版本开始支持在索引中使用函数或者表达式的值，也就是在索引中可以包含函数或者表达式。</p></li></ul> <h2 id="主键索引-primary-key"><a href="#主键索引-primary-key" class="header-anchor">#</a> 主键索引(Primary Key)</h2> <p>数据表的主键列使用的就是主键索引。</p> <p>一张数据表有只能有一个主键，并且主键不能为 null，不能重复。</p> <p>在 MySQL 的 InnoDB 的表中，当没有显示的指定表的主键时，InnoDB 会自动先检查表中是否有唯一索引且不允许存在 null 值的字段，如果有，则选择该字段为默认的主键，否则 InnoDB 将会自动创建一个 6Byte 的自增主键。</p> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032137162.png" alt="主键索引"></p> <h2 id="二级索引"><a href="#二级索引" class="header-anchor">#</a> 二级索引</h2> <p><strong>二级索引（Secondary Index）又称为辅助索引，是因为二级索引的叶子节点存储的数据是主键。也就是说，通过二级索引，可以定位主键的位置。</strong></p> <p>唯一索引，普通索引，前缀索引等索引属于二级索引。</p> <p>PS: 不懂的同学可以暂存疑，慢慢往下看，后面会有答案的，也可以自行搜索。</p> <ol><li><strong>唯一索引(Unique Key)</strong>:唯一索引也是一种约束。唯一索引的属性列不能出现重复的数据，但是允许数据为 NULL，一张表允许创建多个唯一索引。 建立唯一索引的目的大部分时候都是为了该属性列的数据的唯一性，而不是为了查询效率。</li> <li><strong>普通索引(Index)</strong>:普通索引的唯一作用就是为了快速查询数据，一张表允许创建多个普通索引，并允许数据重复和 NULL。</li> <li><strong>前缀索引(Prefix)</strong>:前缀索引只适用于字符串类型的数据。前缀索引是对文本的前几个字符创建索引，相比普通索引建立的数据更小， 因为只取前几个字符。</li> <li><strong>全文索引(Full Text)</strong>:全文索引主要是为了检索大文本数据中的关键字的信息，是目前搜索引擎数据库使用的一种技术。Mysql5.6 之前只有 MYISAM 引擎支持全文索引，5.6 之后 InnoDB 也支持了全文索引。</li></ol> <p>二级索引:</p> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032138916.png" alt="二级索引"></p> <h2 id="聚簇索引与非聚簇索引"><a href="#聚簇索引与非聚簇索引" class="header-anchor">#</a> 聚簇索引与非聚簇索引</h2> <h3 id="聚簇索引-聚集索引"><a href="#聚簇索引-聚集索引" class="header-anchor">#</a> 聚簇索引（聚集索引）</h3> <p><strong>聚簇索引（Clustered Index）即索引结构和数据一起存放的索引，并不是一种单独的索引类型。InnoDB 中的主键索引就属于聚簇索引。</strong></p> <p>在 MySQL 中，InnoDB 引擎的表的 <code>.ibd</code>文件就包含了该表的索引和数据，对于 InnoDB 引擎表来说，该表的索引(B+树)的每个非叶子节点存储索引，叶子节点存储索引和索引对应的数据。</p> <p><strong>聚簇索引的优缺点</strong></p> <p><strong>优点</strong>：</p> <ul><li><strong>查询速度非常快</strong>：聚簇索引的查询速度非常的快，因为整个 B+树本身就是一颗多叉平衡树，叶子节点也都是有序的，定位到索引的节点，就相当于定位到了数据。相比于非聚簇索引， 聚簇索引少了一次读取数据的 IO 操作。</li> <li><strong>对排序查找和范围查找优化</strong>：聚簇索引对于主键的排序查找和范围查找速度非常快。</li></ul> <p><strong>缺点</strong>：</p> <ul><li><strong>依赖于有序的数据</strong>：因为 B+树是多路平衡树，如果索引的数据不是有序的，那么就需要在插入时排序，如果数据是整型还好，否则类似于字符串或 UUID 这种又长又难比较的数据，插入或查找的速度肯定比较慢。</li> <li><strong>更新代价大</strong>：如果对索引列的数据被修改时，那么对应的索引也将会被修改，而且聚簇索引的叶子节点还存放着数据，修改代价肯定是较大的，所以对于主键索引来说，主键一般都是不可被修改的。</li></ul> <h3 id="非聚簇索引-非聚集索引"><a href="#非聚簇索引-非聚集索引" class="header-anchor">#</a> 非聚簇索引（非聚集索引）</h3> <h4 id="非聚簇索引介绍"><a href="#非聚簇索引介绍" class="header-anchor">#</a> 非聚簇索引介绍</h4> <p><strong>非聚簇索引(Non-Clustered Index)即索引结构和数据分开存放的索引，并不是一种单独的索引类型。二级索引(辅助索引)就属于非聚簇索引。MySQL 的 MyISAM 引擎，不管主键还是非主键，使用的都是非聚簇索引。</strong></p> <p>非聚簇索引的叶子节点并不一定存放数据的指针，因为二级索引的叶子节点就存放的是主键，根据主键再回表查数据。</p> <p><strong>非聚簇索引的优缺点</strong></p> <p><strong>优点</strong>：</p> <p>更新代价比聚簇索引要小 。非聚簇索引的更新代价就没有聚簇索引那么大了，非聚簇索引的叶子节点是不存放数据的</p> <p><strong>缺点</strong>：</p> <ul><li><strong>依赖于有序的数据</strong>:跟聚簇索引一样，非聚簇索引也依赖于有序的数据</li> <li><strong>可能会二次查询(回表)</strong>:这应该是非聚簇索引最大的缺点了。 当查到索引对应的指针或主键后，可能还需要根据指针或主键再到数据文件或表中查询。</li></ul> <p>这是 MySQL 的表的文件截图:</p> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032141544.png" alt="MySQL 表的文件"></p> <p>聚簇索引和非聚簇索引:</p> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032142666.png" alt="image-20231103214229613"></p> <h4 id="非聚簇索引一定回表查询吗-覆盖索引"><a href="#非聚簇索引一定回表查询吗-覆盖索引" class="header-anchor">#</a> 非聚簇索引一定回表查询吗(覆盖索引)?</h4> <p><strong>非聚簇索引不一定回表查询。</strong></p> <p>试想一种情况，用户准备使用 SQL 查询用户名，而用户名字段正好建立了索引。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code> <span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">WHERE</span> name<span class="token operator">=</span><span class="token string">'guang19'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>那么这个索引的 key 本身就是 name，查到对应的 name 直接返回就行了，无需回表查询。</p> <p>即使是 MYISAM 也是这样，虽然 MYISAM 的主键索引确实需要回表，因为它的主键索引的叶子节点存放的是指针。但是！<strong>如果 SQL 查的就是主键呢?</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>主键索引本身的 key 就是主键，查到返回就行了。这种情况就称之为覆盖索引了。</p> <h2 id="覆盖索引和联合索引"><a href="#覆盖索引和联合索引" class="header-anchor">#</a> 覆盖索引和联合索引</h2> <h3 id="覆盖索引"><a href="#覆盖索引" class="header-anchor">#</a> 覆盖索引</h3> <p>如果一个索引包含（或者说覆盖）所有需要查询的字段的值，我们就称之为 <strong>覆盖索引（Covering Index）</strong> 。我们知道在 InnoDB 存储引擎中，如果不是主键索引，叶子节点存储的是主键+列值。最终还是要“回表”，也就是要通过主键再查找一次，这样就会比较慢。而覆盖索引就是把要查询出的列和索引是对应的，不做回表操作！</p> <p><strong>覆盖索引即需要查询的字段正好是索引的字段，那么直接根据该索引，就可以查到数据了，而无需回表查询。</strong></p> <blockquote><p>如主键索引，如果一条 SQL 需要查询主键，那么正好根据主键索引就可以查到主键。再如普通索引，如果一条 SQL 需要查询 name，name 字段正好有索引， 那么直接根据这个索引就可以查到数据，也无需回表。</p></blockquote> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032143266.png" alt="image-20231103214332223"></p> <p>我们这里简单演示一下覆盖索引的效果。</p> <p>1、创建一个名为 <code>cus_order</code> 的表，来实际测试一下这种排序方式。为了测试方便， <code>cus_order</code> 这张表只有 <code>id</code>、<code>score</code>、<code>name</code>这 3 个字段。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>cus_order<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>score<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">100000</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2、定义一个简单的存储过程（PROCEDURE）来插入 100w 测试数据。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DEFINER</span><span class="token operator">=</span><span class="token identifier"><span class="token punctuation">`</span>root<span class="token punctuation">`</span></span><span class="token variable">@`%`</span> <span class="token keyword">PROCEDURE</span> <span class="token identifier"><span class="token punctuation">`</span>BatchinsertDataToCusOder<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token operator">IN</span> start_num <span class="token keyword">INT</span><span class="token punctuation">,</span><span class="token operator">IN</span> max_num <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
      <span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">default</span> start_num<span class="token punctuation">;</span>
      <span class="token keyword">WHILE</span> i <span class="token operator">&lt;</span> max_num <span class="token keyword">DO</span>
          <span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token identifier"><span class="token punctuation">`</span>cus_order<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>score<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
          <span class="token keyword">values</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">,</span>CONCAT<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>存储过程定义完成之后，我们执行存储过程即可！</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CALL</span> BatchinsertDataToCusOder<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 插入100w+的随机数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>等待一会，100w 的测试数据就插入完成了！</p> <p>3、创建覆盖索引并使用 <code>EXPLAIN</code> 命令分析。</p> <p>为了能够对这 100w 数据按照 <code>score</code> 进行排序，我们需要执行下面的 SQL 语句。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">`</span>score<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>cus_order<span class="token punctuation">`</span></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token identifier"><span class="token punctuation">`</span>score<span class="token punctuation">`</span></span> <span class="token keyword">DESC</span><span class="token punctuation">;</span><span class="token comment">#降序排序</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用 <code>EXPLAIN</code> 命令分析这条 SQL 语句，通过 <code>Extra</code> 这一列的 <code>Using filesort</code> ，我们发现是没有用到覆盖索引的。</p> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032149067.png" alt="img"></p> <p>不过这也是理所应当，毕竟我们现在还没有创建索引呢！</p> <p>我们这里以 <code>score</code> 和 <code>name</code> 两个字段建立联合索引：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>cus_order<span class="token punctuation">`</span></span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> id_score_name<span class="token punctuation">(</span>score<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建完成之后，再用 <code>EXPLAIN</code> 命令分析再次分析这条 SQL 语句。</p> <p><img src="https://blog-images-luke.oss-cn-shanghai.aliyuncs.com/test/202311032149046.png" alt="img"></p> <p>通过 <code>Extra</code> 这一列的 <code>Using index</code> ，说明这条 SQL 语句成功使用了覆盖索引。</p> <h3 id="联合索引"><a href="#联合索引" class="header-anchor">#</a> 联合索引</h3> <p>使用表中的多个字段创建索引，就是 <strong>联合索引</strong>，也叫 <strong>组合索引</strong> 或 <strong>复合索引</strong>。</p> <p>以 <code>score</code> 和 <code>name</code> 两个字段建立联合索引：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>cus_order<span class="token punctuation">`</span></span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> id_score_name<span class="token punctuation">(</span>score<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="最左前缀匹配原则"><a href="#最左前缀匹配原则" class="header-anchor">#</a> 最左前缀匹配原则</h3> <p>最左前缀匹配原则指的是，在使用联合索引时，<strong>MySQL</strong> 会根据联合索引中的字段顺序，从左到右依次到查询条件中去匹配，如果查询条件中存在与联合索引中最左侧字段相匹配的字段，则就会使用该字段过滤一批数据，直至联合索引中全部字段匹配完成，或者在执行过程中遇到范围查询（如 <strong><code>&gt;</code></strong>、<strong><code>&lt;</code></strong> ）才会停止匹配。对于 <strong><code>&gt;=</code></strong>、<strong><code>&lt;=</code></strong>、<strong><code>BETWEEN</code></strong>、<strong><code>like</code></strong> 前缀匹配的范围查询，并不会停止匹配。所以，我们在使用联合索引时，可以将区分度高的字段放在最左边，这也可以过滤更多数据。</p> <h2 id="索引下推"><a href="#索引下推" class="header-anchor">#</a> 索引下推</h2> <p><strong>索引下推（Index Condition Pushdown）</strong> 是 <strong>MySQL 5.6</strong> 版本中提供的一项索引优化功能，可以在非聚簇索引遍历过程中，对索引中包含的字段先做判断，过滤掉不符合条件的记录，减少回表次数。</p> <h2 id="正确使用索引的一些建议"><a href="#正确使用索引的一些建议" class="header-anchor">#</a> 正确使用索引的一些建议</h2> <h3 id="选择合适的字段创建索引"><a href="#选择合适的字段创建索引" class="header-anchor">#</a> 选择合适的字段创建索引</h3> <ul><li><p><strong>不为 NULL 的字段</strong>：索引字段的数据应该尽量不为 NULL，因为对于数据为 NULL 的字段，数据库较难优化。如果字段频繁被查询，但又避免不了为 NULL，建议使用 0,1,true,false 这样语义较为清晰的短值或短字符作为替代。</p></li> <li><p><strong>被频繁查询的字段</strong>：我们创建索引的字段应该是查询操作非常频繁的字段。</p></li> <li><p><strong>被作为条件查询的字段</strong>：被作为 WHERE 条件查询的字段，应该被考虑建立索引。</p></li> <li><p><strong>频繁需要排序的字段</strong>：索引已经排序，这样查询可以利用索引的排序，加快排序查询时间。</p></li> <li><p><strong>被经常频繁用于连接的字段</strong>：经常用于连接的字段可能是一些外键列，对于外键列并不一定要建立外键，只是说该列涉及到表与表的关系。对于频繁被连接查询的字段，可以考虑建立索引，提高多表连接查询的效率。</p></li></ul> <h3 id="被频繁更新的字段应该慎重建立索引"><a href="#被频繁更新的字段应该慎重建立索引" class="header-anchor">#</a> 被频繁更新的字段应该慎重建立索引</h3> <p>虽然索引能带来查询上的效率，但是维护索引的成本也是不小的。 如果一个字段不被经常查询，反而被经常修改，那么就更不应该在这种字段上建立索引了。</p> <h3 id="限制每张表上的索引数量"><a href="#限制每张表上的索引数量" class="header-anchor">#</a> 限制每张表上的索引数量</h3> <p>索引并不是越多越好，建议单张表索引不超过 5 个！索引可以提高效率同样可以降低效率。</p> <p>索引可以增加查询效率，但同样也会降低插入和更新的效率，甚至有些情况下会降低查询效率。</p> <p>因为 MySQL 优化器在选择如何优化查询时，会根据统一信息，对每一个可以用到的索引来进行评估，以生成出一个最好的执行计划，如果同时有很多个索引都可以用于查询，就会增加 MySQL 优化器生成执行计划的时间，同样会降低查询性能。</p> <h3 id="尽可能的考虑建立联合索引而不是单列索引"><a href="#尽可能的考虑建立联合索引而不是单列索引" class="header-anchor">#</a> 尽可能的考虑建立联合索引而不是单列索引</h3> <p>因为索引是需要占用磁盘空间的，可以简单理解为每个索引都对应着一颗 B+树。如果一个表的字段过多，索引过多，那么当这个表的数据达到一个体量后，索引占用的空间也是很多的，且修改索引时，耗费的时间也是较多的。如果是联合索引，多个字段在一个索引上，那么将会节约很大磁盘空间，且修改数据的操作效率也会提升。</p> <h3 id="注意避免冗余索引"><a href="#注意避免冗余索引" class="header-anchor">#</a> 注意避免冗余索引</h3> <p>冗余索引指的是索引的功能相同，能够命中索引(a, b)就肯定能命中索引(a) ，那么索引(a)就是冗余索引。如（name,city ）和（name ）这两个索引就是冗余索引，能够命中前者的查询肯定是能够命中后者的 在大多数情况下，都应该尽量扩展已有的索引而不是创建新索引。</p> <h3 id="字符串类型的字段使用前缀索引代替普通索引"><a href="#字符串类型的字段使用前缀索引代替普通索引" class="header-anchor">#</a> 字符串类型的字段使用前缀索引代替普通索引</h3> <p>前缀索引仅限于字符串类型，较普通索引会占用更小的空间，所以可以考虑使用前缀索引带替普通索引。</p> <h3 id="避免索引失效"><a href="#避免索引失效" class="header-anchor">#</a> 避免索引失效</h3> <p>索引失效也是慢查询的主要原因之一，常见的导致索引失效的情况有下面这些：</p> <ul><li><s>使用 SELECT 进行查询;</s> <code>SELECT *</code> 不会直接导致索引失效（如果不走索引大概率是因为 where 查询范围过大导致的），但它可能会带来一些其他的性能问题比如造成网络传输和数据处理的浪费、无法使用索引覆盖;</li> <li>创建了组合索引，但查询条件未准守最左匹配原则;</li> <li>在索引列上进行计算、函数、类型转换等操作;</li> <li>以 % 开头的 LIKE 查询比如 <code>LIKE '%abc';</code>;</li> <li>查询条件中使用 OR，且 OR 的前后条件中有一个列没有索引，涉及的索引都不会被使用到;</li> <li>IN 的取值范围较大时会导致索引失效，走全表扫描(NOT IN 和 IN 的失效场景相同);</li> <li>发生隐式转换；</li></ul> <p><strong>参考</strong></p> <ul><li>https://javaguide.cn/database/mysql/mysql-logs.html</li></ul></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">11/3/2023, 10:17:08 PM</span></div></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#索引介绍" class="sidebar-link reco-side-索引介绍" data-v-b57cc07c>索引介绍</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#索引的优缺点" class="sidebar-link reco-side-索引的优缺点" data-v-b57cc07c>索引的优缺点</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#索引底层数据结构选型" class="sidebar-link reco-side-索引底层数据结构选型" data-v-b57cc07c>索引底层数据结构选型</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#hash表" class="sidebar-link reco-side-hash表" data-v-b57cc07c>Hash表</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#二叉查找树-bst" class="sidebar-link reco-side-二叉查找树-bst" data-v-b57cc07c>二叉查找树(BST)</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#avl-树" class="sidebar-link reco-side-avl-树" data-v-b57cc07c>AVL 树</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#红黑树" class="sidebar-link reco-side-红黑树" data-v-b57cc07c>红黑树</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#b-树-b-树" class="sidebar-link reco-side-b-树-b-树" data-v-b57cc07c>B 树&amp; B+树</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#索引类型总结" class="sidebar-link reco-side-索引类型总结" data-v-b57cc07c>索引类型总结</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#主键索引-primary-key" class="sidebar-link reco-side-主键索引-primary-key" data-v-b57cc07c>主键索引(Primary Key)</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#二级索引" class="sidebar-link reco-side-二级索引" data-v-b57cc07c>二级索引</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#聚簇索引与非聚簇索引" class="sidebar-link reco-side-聚簇索引与非聚簇索引" data-v-b57cc07c>聚簇索引与非聚簇索引</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#聚簇索引-聚集索引" class="sidebar-link reco-side-聚簇索引-聚集索引" data-v-b57cc07c>聚簇索引（聚集索引）</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#非聚簇索引-非聚集索引" class="sidebar-link reco-side-非聚簇索引-非聚集索引" data-v-b57cc07c>非聚簇索引（非聚集索引）</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#覆盖索引和联合索引" class="sidebar-link reco-side-覆盖索引和联合索引" data-v-b57cc07c>覆盖索引和联合索引</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#覆盖索引" class="sidebar-link reco-side-覆盖索引" data-v-b57cc07c>覆盖索引</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#联合索引" class="sidebar-link reco-side-联合索引" data-v-b57cc07c>联合索引</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#最左前缀匹配原则" class="sidebar-link reco-side-最左前缀匹配原则" data-v-b57cc07c>最左前缀匹配原则</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#索引下推" class="sidebar-link reco-side-索引下推" data-v-b57cc07c>索引下推</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#正确使用索引的一些建议" class="sidebar-link reco-side-正确使用索引的一些建议" data-v-b57cc07c>正确使用索引的一些建议</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#选择合适的字段创建索引" class="sidebar-link reco-side-选择合适的字段创建索引" data-v-b57cc07c>选择合适的字段创建索引</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#被频繁更新的字段应该慎重建立索引" class="sidebar-link reco-side-被频繁更新的字段应该慎重建立索引" data-v-b57cc07c>被频繁更新的字段应该慎重建立索引</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#限制每张表上的索引数量" class="sidebar-link reco-side-限制每张表上的索引数量" data-v-b57cc07c>限制每张表上的索引数量</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#尽可能的考虑建立联合索引而不是单列索引" class="sidebar-link reco-side-尽可能的考虑建立联合索引而不是单列索引" data-v-b57cc07c>尽可能的考虑建立联合索引而不是单列索引</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#注意避免冗余索引" class="sidebar-link reco-side-注意避免冗余索引" data-v-b57cc07c>注意避免冗余索引</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#字符串类型的字段使用前缀索引代替普通索引" class="sidebar-link reco-side-字符串类型的字段使用前缀索引代替普通索引" data-v-b57cc07c>字符串类型的字段使用前缀索引代替普通索引</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/MySQL%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A3.html#避免索引失效" class="sidebar-link reco-side-避免索引失效" data-v-b57cc07c>避免索引失效</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.b6f48787.js" defer></script><script src="/assets/js/7.ec9bc4d0.js" defer></script><script src="/assets/js/2.0c7886bd.js" defer></script><script src="/assets/js/1.8f3833ee.js" defer></script><script src="/assets/js/49.2076ec88.js" defer></script>
  </body>
</html>
